# Vector Aggregator Configuration File
# Generated by Ansible for {{ ansible_hostname }}
# Role: Consume logs from Redpanda and send to Loki

# Data Directory
data_dir: /var/lib/vector

# Sources - Consume from Redpanda
sources:
  kafka_logs:
    type: kafka
    bootstrap_servers: "{{ redpanda_host | default('192.168.2.90') }}:{{ redpanda_port | default('9092') }}"
    group_id: "{{ loki_consumer_group | default('loki-consumer') }}"
    topics:
      - "{{ redpanda_topic | default('logs') }}"
    decoding:
      codec: json

# Sinks - Send to Loki
sinks:
  loki:
    type: loki
    inputs:
      - kafka_logs
    endpoint: "http://127.0.0.1:3100"
    encoding:
      codec: json

    # Loki label mapping
    labels:
      hostname: "{{ '{{ hostname }}' }}"
      service: "{{ '{{ service }}' }}"
      log_level: "{{ '{{ log_level }}' }}"
      node_type: "{{ '{{ node_type }}' }}"
      vlan: "{{ '{{ vlan }}' }}"

    # Health check
    healthcheck:
      enabled: true
